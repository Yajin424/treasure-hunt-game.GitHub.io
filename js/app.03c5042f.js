(()=>{"use strict";var e={906:(e,s,t)=>{var n=t(751),r=t(641);function a(e,s,t,n,a,o){const i=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.Wv)(i)}const o={name:"App"};var i=t(262);const c=(0,i.A)(o,[["render",a]]),l=c;var u=t(499),d=t(33);const h={class:"game-view"},m={key:0,class:"login-container"},k={key:1,class:"game-container"},g={class:"panorama-wrapper"},p={class:"panorama-header"},v={class:"player-info"},y={class:"panorama-controls"},L={key:2,class:"game-container"},f={class:"game-header"},C={class:"player-info"},b={class:"game-controls"},S={class:"scene-navigation"},T=["onClick"],U={key:0,class:"lock-icon"},$={key:1,class:"completed-icon"},x={class:"game-scene"},_={key:0,class:"simple-rank"},w={class:"rank-header"},X={class:"rank-list"},I={class:"rank-number"},E={class:"rank-name"},D={class:"rank-score"},P={class:"clues-collection"},F={class:"clues-list"},A={ref:"audioPlayer",loop:""};function G(e,s,t,n,a,o){const i=(0,r.g2)("UserLogin"),c=(0,r.g2)("Panorama"),l=(0,r.g2)("LibraryScene"),u=(0,r.g2)("ForestScene"),G=(0,r.g2)("RiverScene"),M=(0,r.g2)("TempleScene"),R=(0,r.g2)("ChamberScene");return(0,r.uX)(),(0,r.CE)("div",h,[a.isLoggedIn?a.showPanorama?((0,r.uX)(),(0,r.CE)("div",k,[(0,r.Lk)("div",g,[(0,r.Lk)("div",p,[(0,r.Lk)("div",v,[(0,r.Lk)("h3",null,(0,d.v_)(a.currentUser.username),1),(0,r.Lk)("p",null,"得分: "+(0,d.v_)(a.currentUser.score)+" | 宝藏: "+(0,d.v_)(a.currentUser.treasures),1)]),(0,r.Lk)("div",y,[(0,r.Lk)("button",{onClick:s[0]||(s[0]=(...e)=>o.toggleAudio&&o.toggleAudio(...e))},(0,d.v_)(a.isAudioPlaying?"🔊 静音":"🔈 开启音效"),1),(0,r.Lk)("button",{onClick:s[1]||(s[1]=(...e)=>o.showRankList&&o.showRankList(...e))},"🏆 排行榜")])]),(0,r.bF)(c,{scenes:o.gameScenes,currentScene:a.currentScene,onSceneClick:o.handleSceneClick},null,8,["scenes","currentScene","onSceneClick"])])])):((0,r.uX)(),(0,r.CE)("div",L,[(0,r.Lk)("div",f,[(0,r.Lk)("div",C,[(0,r.Lk)("h3",null,(0,d.v_)(a.currentUser.username),1),(0,r.Lk)("p",null,"得分: "+(0,d.v_)(a.currentUser.score)+" | 宝藏: "+(0,d.v_)(a.currentUser.treasures),1)]),(0,r.Lk)("div",b,[(0,r.Lk)("button",{onClick:s[2]||(s[2]=(...e)=>o.toggleAudio&&o.toggleAudio(...e))},(0,d.v_)(a.isAudioPlaying?"🔊 静音":"🔈 开启音效"),1),(0,r.Lk)("button",{onClick:s[3]||(s[3]=(...e)=>o.showRankList&&o.showRankList(...e))},"🏆 排行榜"),(0,r.Lk)("button",{onClick:s[4]||(s[4]=(...e)=>o.backToPanorama&&o.backToPanorama(...e))},"🗺️ 全景地图"),(0,r.Lk)("div",S,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.availableScenes,e=>((0,r.uX)(),(0,r.CE)("button",{key:e,class:(0,d.C4)({active:a.currentScene===e,locked:!o.isSceneUnlocked(e)}),onClick:s=>o.changeScene(e)},[(0,r.eW)((0,d.v_)(o.getSceneName(e))+" ",1),o.isSceneUnlocked(e)?o.isSceneCompleted(e)?((0,r.uX)(),(0,r.CE)("span",$,"🏆")):(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",U,"🔒"))],10,T))),128))])])]),(0,r.Lk)("div",x,["library"===a.currentScene?((0,r.uX)(),(0,r.Wv)(l,{key:0,onTreasureFound:o.handleTreasureFound,onClueFound:o.handleFoundClue},null,8,["onTreasureFound","onClueFound"])):(0,r.Q3)("",!0),"forest"===a.currentScene?((0,r.uX)(),(0,r.Wv)(u,{key:1,onTreasureFound:o.handleTreasureFound},null,8,["onTreasureFound"])):(0,r.Q3)("",!0),"river"===a.currentScene?((0,r.uX)(),(0,r.Wv)(G,{key:2,onTreasureFound:o.handleTreasureFound},null,8,["onTreasureFound"])):(0,r.Q3)("",!0),"temple"===a.currentScene?((0,r.uX)(),(0,r.Wv)(M,{key:3,onTreasureFound:o.handleTreasureFound},null,8,["onTreasureFound"])):(0,r.Q3)("",!0),"chamber"===a.currentScene?((0,r.uX)(),(0,r.Wv)(R,{key:4,onTreasureFound:o.handleTreasureFound},null,8,["onTreasureFound"])):(0,r.Q3)("",!0)]),a.showRank?((0,r.uX)(),(0,r.CE)("div",_,[(0,r.Lk)("div",w,[s[6]||(s[6]=(0,r.Lk)("h2",null,"排行榜",-1)),(0,r.Lk)("button",{onClick:s[5]||(s[5]=e=>a.showRank=!1)},"关闭")]),(0,r.Lk)("div",X,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.rankedPlayers,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"rank-item"},[(0,r.Lk)("span",I,(0,d.v_)(s+1),1),(0,r.Lk)("span",E,(0,d.v_)(e.username),1),(0,r.Lk)("span",D,(0,d.v_)(e.score)+"分",1)]))),128))])])):(0,r.Q3)("",!0),(0,r.Lk)("div",P,[s[7]||(s[7]=(0,r.Lk)("h4",null,"收集的线索",-1)),(0,r.Lk)("div",F,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.collectedClues,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"clue-item"},(0,d.v_)(o.getSceneName(e.scene))+":"+(0,d.v_)(e.clue),1))),128))])]),(0,r.Lk)("audio",A,[...s[8]||(s[8]=[(0,r.Lk)("source",{src:"/audio/game-background.mp3",type:"audio/mpeg"},null,-1)])],512)])):((0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(i,{onLogin:o.handleLogin},null,8,["onLogin"])]))])}const M={class:"scene-content"},R={class:"bookshelves"},W=["onClick"];function B(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"library-scene",onClick:s[1]||(s[1]=(...e)=>i.handleClick&&i.handleClick(...e))},[(0,r.Lk)("div",{class:"scene-background",style:(0,d.Tr)({backgroundImage:`url(${o.backgroundImage})`})},null,4),(0,r.Lk)("div",M,[s[4]||(s[4]=(0,r.Lk)("h2",null,"古老的图书馆",-1)),s[5]||(s[5]=(0,r.Lk)("p",{class:"scene-description"},"满是灰尘的书架上摆满了古老的书籍。空气中弥漫着纸张和墨水的味道。一本书似乎在微微发光...",-1)),(0,r.Lk)("div",R,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.bookshelves,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"bookshelf",style:(0,d.Tr)({left:e.x+"%",top:e.y+"%",height:e.height+"px"})},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.books,t=>((0,r.uX)(),(0,r.CE)("div",{key:t.id,class:(0,d.C4)(["book",{highlighted:t.highlighted,discovered:t.discovered}]),onClick:(0,n.D$)(s=>i.examineBook(t,e,s),["stop"])},[...s[2]||(s[2]=[(0,r.Lk)("span",{class:"book-spine"},null,-1)])],10,W))),128))],4))),128))]),o.showMysteryBook?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"mystery-book",onClick:s[0]||(s[0]=(0,n.D$)((...e)=>i.openMysteryBook&&i.openMysteryBook(...e),["stop"]))},[...s[3]||(s[3]=[(0,r.Lk)("div",{class:"book-icon"},"📜",-1)])])):(0,r.Q3)("",!0)])])}const O={name:"LibraryScene",data(){return{backgroundImage:"/images/scenes/古老的图书馆.png",bookshelves:[{id:1,x:15,y:30,height:400,books:Array.from({length:12},(e,s)=>({id:`1-${s}`,highlighted:5===s,discovered:!1}))},{id:2,x:40,y:40,height:300,books:Array.from({length:8},(e,s)=>({id:`2-${s}`,highlighted:2===s,discovered:!1}))},{id:3,x:70,y:35,height:350,books:Array.from({length:10},(e,s)=>({id:`3-${s}`,highlighted:7===s,discovered:!1}))}],showMysteryBook:!1,discoveredClues:0}},methods:{handleClick(e){},examineBook(e,s,t){if(e.highlighted&&!e.discovered){e.discovered=!0,this.discoveredClues++,this.checkForMysteryBook(),this.$emit("clueFound",{scene:"library",clue:`从书架${s.id}找到的古老笔记`});const n=t.currentTarget;n.style.transform="scale(1.1) rotate(5deg)",setTimeout(()=>{n.style.transform=""},500)}},checkForMysteryBook(){const e=this.bookshelves.reduce((e,s)=>e+s.books.filter(e=>e.highlighted).length,0);this.discoveredClues===e&&setTimeout(()=>{this.showMysteryBook=!0},1e3)},openMysteryBook(){this.$emit("treasureFound",{score:220,scene:"library",timeBonus:30})}}},N=(0,i.A)(O,[["render",B],["__scopeId","data-v-56697245"]]),Q=N,K={class:"scene-content"},H={class:"clues"};function q(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"forest-scene",onClick:s[1]||(s[1]=(...e)=>i.handleClick&&i.handleClick(...e))},[(0,r.Lk)("div",{class:"scene-background",style:(0,d.Tr)({backgroundImage:`url(${o.backgroundImage})`})},null,4),(0,r.Lk)("div",K,[s[3]||(s[3]=(0,r.Lk)("h2",null,"神秘森林",-1)),s[4]||(s[4]=(0,r.Lk)("p",{class:"scene-description"},"你在一片古老的森林中，树木高耸入云。阳光透过树叶洒下斑驳的光影。远处似乎有什么东西在闪闪发光...",-1)),(0,r.Lk)("div",H,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.clues,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"clue",style:(0,d.Tr)({left:e.x+"%",top:e.y+"%"})},null,4))),128))]),o.showTreasure?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"treasure",style:(0,d.Tr)({left:o.treasurePosition.x+"%",top:o.treasurePosition.y+"%"}),onClick:s[0]||(s[0]=(0,n.D$)((...e)=>i.discoverTreasure&&i.discoverTreasure(...e),["stop"]))},[...s[2]||(s[2]=[(0,r.Lk)("div",{class:"treasure-chest"},"💎",-1)])],4)):(0,r.Q3)("",!0)])])}const j={name:"ForestScene",data(){return{backgroundImage:"/images/scenes/forest/forest.png",clues:[{id:1,x:20,y:40},{id:2,x:60,y:30},{id:3,x:75,y:65}],showTreasure:!1,treasurePosition:{x:50,y:50},discoveredClues:0}},methods:{handleClick(e){const s=e.currentTarget.getBoundingClientRect(),t=(e.clientX-s.left)/s.width*100,n=(e.clientY-s.top)/s.height*100;this.clues.forEach(e=>{Math.abs(t-e.x)<5&&Math.abs(n-e.y)<5&&!e.discovered&&(e.discovered=!0,this.discoveredClues++,this.checkTreasureVisibility())})},checkTreasureVisibility(){this.discoveredClues===this.clues.length&&setTimeout(()=>{this.showTreasure=!0},1e3)},discoverTreasure(){this.$emit("treasureFound",{score:150,scene:"forest",timeBonus:15})}}},J=(0,i.A)(j,[["render",q],["__scopeId","data-v-66d591e2"]]),V=J,z={class:"scene-content"},Y={class:"items"},Z=["onClick"];function ee(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"river-scene",onClick:s[0]||(s[0]=(...e)=>i.handleClick&&i.handleClick(...e))},[(0,r.Lk)("div",{class:"scene-background",style:(0,d.Tr)({backgroundImage:`url(${o.backgroundImage})`})},null,4),(0,r.Lk)("div",z,[s[1]||(s[1]=(0,r.Lk)("h2",null,"神秘河流",-1)),s[2]||(s[2]=(0,r.Lk)("p",{class:"scene-description"},"一条宽阔的河流横亘在你面前，河水波光粼粼。对岸似乎有什么秘密在等待着你...",-1)),(0,r.Lk)("div",Y,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.items,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"item",style:(0,d.Tr)({left:e.x+"%",top:e.y+"%"}),onClick:(0,n.D$)(s=>i.examineItem(e),["stop"])},(0,d.v_)(e.icon),13,Z))),128))])])])}const se={name:"RiverScene",data(){return{backgroundImage:"/images/scenes/river/river.png",items:[{id:1,x:30,y:50,icon:"⛵",type:"boat",discovered:!1},{id:2,x:70,y:60,icon:"🔑",type:"key",discovered:!1},{id:3,x:45,y:30,icon:"🗺️",type:"map",discovered:!1}],collectedItems:[]}},methods:{handleClick(e){},examineItem(e){e.discovered||(e.discovered=!0,this.collectedItems.push(e.type),this.checkWinCondition())},checkWinCondition(){const e=["boat","key"],s=e.every(e=>this.collectedItems.includes(e));s&&setTimeout(()=>{this.$emit("treasureFound",{score:180,scene:"river",timeBonus:20})},1e3)}}},te=(0,i.A)(se,[["render",ee],["__scopeId","data-v-096f8e54"]]),ne=te,re={class:"scene-content"},ae={class:"wall-gems"},oe=["onClick"],ie={class:"treasure-box"},ce={key:0,class:"treasure-lock"};function le(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"chamber-scene",onClick:s[1]||(s[1]=(...e)=>i.handleClick&&i.handleClick(...e))},[(0,r.Lk)("div",{class:"scene-background",style:(0,d.Tr)({backgroundImage:`url(${o.backgroundImage})`})},null,4),(0,r.Lk)("div",re,[s[2]||(s[2]=(0,r.Lk)("h2",null,"宝藏密室",-1)),s[3]||(s[3]=(0,r.Lk)("p",{class:"scene-description"},"你终于找到了传说中的宝藏密室！墙壁上镶嵌着宝石，中央有一个巨大的宝箱...",-1)),(0,r.Lk)("div",ae,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.wallGems,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"wall-gem",style:(0,d.Tr)({left:e.x+"%",top:e.y+"%"}),onClick:(0,n.D$)(s=>i.activateGem(e),["stop"])},(0,d.v_)(e.icon),13,oe))),128))]),(0,r.Lk)("div",{class:"main-treasure",onClick:s[0]||(s[0]=(0,n.D$)((...e)=>i.openMainTreasure&&i.openMainTreasure(...e),["stop"]))},[(0,r.Lk)("div",ie,(0,d.v_)(o.mainTreasureIcon),1),i.allGemsActivated?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",ce," 🔒 "))])])])}const ue={name:"ChamberScene",data(){return{backgroundImage:"/images/scenes/宝藏密室.png",wallGems:[{id:1,x:20,y:30,icon:"💎",activated:!1},{id:2,x:80,y:35,icon:"💎",activated:!1},{id:3,x:25,y:70,icon:"💎",activated:!1},{id:4,x:75,y:65,icon:"💎",activated:!1}],mainTreasureIcon:"📦",activatedGems:0}},computed:{allGemsActivated(){return this.activatedGems===this.wallGems.length}},methods:{handleClick(e){},activateGem(e){if(!e.activated){e.activated=!0,this.activatedGems++;const s=event.target;s.style.animation="gemActivate 1s ease",setTimeout(()=>{s.style.animation=""},1e3)}},openMainTreasure(){if(this.allGemsActivated){this.mainTreasureIcon="💰";const e=this.$el.querySelector(".treasure-box");e.style.transform="scale(1.5) rotate(10deg)",setTimeout(()=>{this.$emit("treasureFound",{score:500,scene:"chamber",timeBonus:50,finalTreasure:!0})},1500)}else alert("宝箱被魔法锁住了！需要激活所有墙上的宝石才能打开。")}}},de=(0,i.A)(ue,[["render",le],["__scopeId","data-v-fa80ab12"]]),he=de,me={class:"scene-content"},ke={class:"gate-symbol"},ge={class:"gate-locks"},pe={class:"lock-icon"},ve={class:"gems"},ye=["onClick"];function Le(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"temple-scene",onClick:s[1]||(s[1]=(...e)=>i.handleClick&&i.handleClick(...e))},[(0,r.Lk)("div",{class:"scene-background",style:(0,d.Tr)({backgroundImage:`url(${o.backgroundImage})`})},null,4),(0,r.Lk)("div",me,[s[2]||(s[2]=(0,r.Lk)("h2",null,"太阳神殿",-1)),s[3]||(s[3]=(0,r.Lk)("p",{class:"scene-description"},"古老的太阳神殿在阳光下闪耀着金色的光芒。传说这里藏着失落的宝藏，但机关重重...",-1)),(0,r.Lk)("div",{class:"temple-gate",onClick:s[0]||(s[0]=(0,n.D$)((...e)=>i.interactWithGate&&i.interactWithGate(...e),["stop"]))},[(0,r.Lk)("div",ke,(0,d.v_)(o.gateSymbol),1),(0,r.Lk)("div",ge,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.locks,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:(0,d.C4)(["lock",{unlocked:e.unlocked}])},[(0,r.Lk)("span",pe,(0,d.v_)(e.icon),1)],2))),128))])]),(0,r.Lk)("div",ve,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.gems,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"gem",style:(0,d.Tr)({left:e.x+"%",top:e.y+"%"}),onClick:(0,n.D$)(s=>i.collectGem(e),["stop"])},(0,d.v_)(e.icon),13,ye))),128))])])])}const fe={name:"TempleScene",data(){return{backgroundImage:"/images/scenes/太阳神殿.png",gateSymbol:"☀️",locks:[{icon:"🔒",unlocked:!1},{icon:"🔒",unlocked:!1},{icon:"🔒",unlocked:!1}],gems:[{id:1,x:25,y:60,icon:"💎",collected:!1},{id:2,x:75,y:55,icon:"💎",collected:!1},{id:3,x:50,y:30,icon:"💎",collected:!1}],collectedGems:0}},methods:{handleClick(e){},collectGem(e){e.collected||(e.collected=!0,this.collectedGems++,this.updateLocks())},updateLocks(){for(let e=0;e<this.collectedGems&&e<this.locks.length;e++)this.locks[e].unlocked=!0,this.locks[e].icon="🔓"},interactWithGate(){const e=this.locks.every(e=>e.unlocked);e?this.$emit("treasureFound",{score:200,scene:"temple",timeBonus:25}):alert("大门仍然锁着，需要找到更多的宝石！")}}},Ce=(0,i.A)(fe,[["render",Le],["__scopeId","data-v-eb4d6508"]]),be=Ce,Se={class:"scenes-container"},Te=["onClick"],Ue=["src"],$e={class:"scene-overlay"},xe={key:0,class:"lock-overlay"},_e={key:0,class:"drag-hint"};function we(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",{class:"panorama-container",ref:"panoramaContainer",onMousedown:s[1]||(s[1]=(...e)=>i.startDrag&&i.startDrag(...e)),onMouseup:s[2]||(s[2]=(...e)=>i.endDrag&&i.endDrag(...e)),onMousemove:s[3]||(s[3]=(...e)=>i.onDrag&&i.onDrag(...e)),onMouseleave:s[4]||(s[4]=(...e)=>i.endDrag&&i.endDrag(...e))},[(0,r.Lk)("div",{class:"panorama",style:(0,d.Tr)({transform:`translateX(${o.position.x}px)`})},[(0,r.Lk)("div",Se,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.scenes,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,d.C4)(["scene-image-wrapper",{active:t.currentScene===e.id,locked:!e.unlocked}]),onClick:s=>i.onSceneClick(e)},[(0,r.Lk)("img",{src:e.imageUrl,alt:"{{ scene.name }}",class:"scene-image",onMousedown:s[0]||(s[0]=(0,n.D$)((...e)=>i.startDrag&&i.startDrag(...e),["stop"]))},null,40,Ue),(0,r.Lk)("div",$e,[(0,r.Lk)("h3",null,(0,d.v_)(e.name),1),e.unlocked?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",xe,"🔒"))])],10,Te))),128))])],4),o.showDragHint?((0,r.uX)(),(0,r.CE)("div",_e,[...s[5]||(s[5]=[(0,r.Lk)("p",null,"按住鼠标拖动查看全景",-1),(0,r.Lk)("p",null,"点击已解锁场景进入",-1)])])):(0,r.Q3)("",!0)],544)}const Xe={name:"Panorama",props:{scenes:{type:Array,required:!0},currentScene:{type:String,default:""}},data(){return{position:{x:0},isDragging:!1,startX:0,startPosition:{x:0},maxWidth:0,showDragHint:!0,imageLoadedCount:0}},mounted(){window.addEventListener("resize",this.calculateMaxWidth),setTimeout(()=>{this.showDragHint=!1},5e3),this.checkImagesLoaded()},beforeUnmount(){window.removeEventListener("resize",this.calculateMaxWidth)},methods:{checkImagesLoaded(){this.$nextTick(()=>{const e=this.$refs.panoramaContainer?.querySelectorAll(".scene-image");e&&0!==e.length?(e.forEach(s=>{s.complete?this.imageLoadedCount++:s.onload=()=>{this.imageLoadedCount++,this.imageLoadedCount===e.length&&this.calculateMaxWidth()}}),this.imageLoadedCount===e.length&&this.calculateMaxWidth()):setTimeout(this.checkImagesLoaded,100)})},calculateMaxWidth(){const e=this.$refs.panoramaContainer?.clientWidth||0,s=this.$refs.panoramaContainer?.querySelector(".scenes-container"),t=s?s.scrollWidth:0;this.maxWidth=Math.max(0,t-e)},startDrag(e){this.isDragging=!0,this.startX=e.clientX,this.startPosition.x=this.position.x,document.body.style.cursor="grabbing",this.$refs.panoramaContainer&&(this.$refs.panoramaContainer.style.cursor="grabbing")},endDrag(){this.isDragging=!1,document.body.style.cursor="default",this.$refs.panoramaContainer&&(this.$refs.panoramaContainer.style.cursor="grab")},onDrag(e){if(!this.isDragging)return;const s=e.clientX-this.startX;let t=this.startPosition.x+s;t=Math.max(-this.maxWidth,Math.min(0,t)),this.position.x=t},onSceneClick(e){this.isDragging||(e.unlocked?this.$emit("sceneClick",e.id):alert(`需要达到${e.unlockScore}分才能解锁${e.name}！`))},scrollToScene(e){const s=this.scenes.find(s=>s.id===e);if(!s||!this.$refs.panoramaContainer)return;const t=this.$refs.panoramaContainer.clientWidth,n=this.$refs.panoramaContainer.querySelector(".scenes-container"),r=this.$refs.panoramaContainer.querySelector(`.scene-image-wrapper:nth-child(${this.scenes.findIndex(s=>s.id===e)+1})`);if(!n||!r)return;const a=r.getBoundingClientRect(),o=this.$refs.panoramaContainer.getBoundingClientRect(),i=-(a.left-o.left-(t-a.width)/2),c=n.scrollWidth,l=Math.max(0,c-t),u=Math.max(-l,Math.min(0,i));this.smoothScrollTo(u)},smoothScrollTo(e){const s=500,t=this.position.x,n=e-t,r=performance.now(),a=e=>{const o=e-r,i=Math.min(o/s,1),c=i*(2-i);this.position.x=t+n*c,i<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}}},Ie=(0,i.A)(Xe,[["render",we],["__scopeId","data-v-6fff548f"]]),Ee=Ie,De={class:"login-container"},Pe={class:"login-form"},Fe={class:"form-group"},Ae=["disabled"],Ge={class:"guest-option"};function Me(e,s,t,a,o,i){return(0,r.uX)(),(0,r.CE)("div",De,[(0,r.Lk)("div",Pe,[s[3]||(s[3]=(0,r.Lk)("h2",null,"寻宝游戏",-1)),s[4]||(s[4]=(0,r.Lk)("p",{class:"login-subtitle"},"请输入您的名字开始冒险",-1)),(0,r.Lk)("form",{onSubmit:s[1]||(s[1]=(0,n.D$)((...e)=>i.handleLogin&&i.handleLogin(...e),["prevent"]))},[(0,r.Lk)("div",Fe,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>o.username=e),placeholder:"请输入您的名字",class:"form-input",required:"",minlength:"2"},null,512),[[n.Jo,o.username]])]),(0,r.Lk)("button",{type:"submit",class:"login-btn",disabled:!o.username.trim()}," 开始冒险 ",8,Ae)],32),(0,r.Lk)("div",Ge,[(0,r.Lk)("button",{onClick:s[2]||(s[2]=(...e)=>i.loginAsGuest&&i.loginAsGuest(...e)),class:"guest-btn"}," 以游客身份开始 ")]),s[5]||(s[5]=(0,r.Lk)("div",{class:"game-info"},[(0,r.Lk)("p",null,"🏆 寻找隐藏的宝藏"),(0,r.Lk)("p",null,"🗺️ 探索神秘场景"),(0,r.Lk)("p",null,"⏱️ 挑战最快速度")],-1))])])}const Re={name:"UserLogin",data(){return{username:""}},methods:{handleLogin(){this.username.trim()&&this.$emit("login",{username:this.username.trim(),isGuest:!1,timestamp:(new Date).getTime()})},loginAsGuest(){const e="游客"+Math.floor(1e4*Math.random());this.$emit("login",{username:e,isGuest:!0,timestamp:(new Date).getTime()})}}},We=(0,i.A)(Re,[["render",Me],["__scopeId","data-v-12dee1dc"]]),Be=We,Oe={name:"GameView",components:{LibraryScene:Q,ForestScene:V,RiverScene:ne,ChamberScene:he,TempleScene:be,Panorama:Ee,UserLogin:Be},data(){return{isLoggedIn:!1,username:"",currentUser:{username:"",score:0,treasures:0,completedScenes:[]},currentScene:"library",showPanorama:!0,collectedClues:[],showTreasureAlert:!1,treasureAlertMessage:"",showRank:!1,isAudioPlaying:!1,players:[]}},computed:{rankedPlayers(){const e=[...this.players],s=e.findIndex(e=>e.username===this.currentUser.username);return-1===s?e.push({...this.currentUser}):e[s]={...this.currentUser},e.sort((e,s)=>s.score-e.score)},availableScenes(){return["library","forest","river","temple","chamber"]},gameScenes(){return[{id:"library",name:"古老的图书馆",imageUrl:"/images/scenes/古老的图书馆.png",unlocked:!0,unlockScore:0},{id:"forest",name:"神秘森林",imageUrl:"/images/scenes/forest/forest.png",unlocked:this.isSceneUnlocked("forest"),unlockScore:100},{id:"river",name:"河流探险",imageUrl:"/images/scenes/river/river.png",unlocked:this.isSceneUnlocked("river"),unlockScore:300},{id:"temple",name:"太阳神殿",imageUrl:"/images/scenes/太阳神殿.png",unlocked:this.isSceneUnlocked("temple"),unlockScore:500},{id:"chamber",name:"宝藏密室",imageUrl:"/images/scenes/宝藏密室.png",unlocked:this.isSceneUnlocked("chamber"),unlockScore:800}]}},methods:{handleSceneClick(e){this.changeScene(e)},handleLogin(e){this.isLoggedIn=!0,this.currentUser.username=e.username,this.currentUser.isGuest=e.isGuest,this.loadUserData(),this.showPanorama=!0},loadUserData(){const e=localStorage.getItem("treasureHuntData");if(e){const s=JSON.parse(e);this.players=s.players||[];const t=this.players.find(e=>e.username===this.currentUser.username);t?this.currentUser={...t}:this.currentUser.completedScenes=[],this.collectedClues=s.collectedClues||[]}else this.currentUser.completedScenes=[]},saveUserData(){const e={currentScene:this.currentScene,collectedClues:this.collectedClues,players:this.rankedPlayers};localStorage.setItem("treasureHuntData",JSON.stringify(e))},isSceneUnlocked(e){const s=!1;if(s)return!0;const t={library:0,forest:100,river:300,temple:500,chamber:800};return this.currentUser.score>=t[e]},isSceneCompleted(e){return this.currentUser.completedScenes.includes(e)},changeScene(e){if(this.isSceneUnlocked(e))this.currentScene=e,this.showPanorama=!1,this.saveUserData();else{const s={library:0,forest:100,river:300,temple:500,chamber:800};alert(`需要达到${s[e]}分才能解锁${this.getSceneName(e)}！`)}},handleFoundClue(e){const s=this.collectedClues.some(s=>s.scene===e.scene&&s.clue===e.clue);if(!s){this.collectedClues.push(e),this.currentUser.score+=50,this.saveUserData();const s=this.$options.components.TreasureAlert;s?this.$alert(`获得线索: ${this.getSceneName(e.scene)}: ${e.clue}`,"发现线索",{confirmButtonText:"确定"}):alert(`获得线索: ${this.getSceneName(e.scene)}: ${e.clue}`)}},toggleAudio(){this.isAudioPlaying?this.$refs.audioPlayer&&this.$refs.audioPlayer.pause():this.$refs.audioPlayer&&this.$refs.audioPlayer.play(),this.isAudioPlaying=!this.isAudioPlaying},showRankList(){this.showRank=!0},handleTreasureFound(e){this.currentUser.score+=e.score,this.currentUser.treasures+=1,this.currentUser.completedScenes.includes(e.scene)||this.currentUser.completedScenes.push(e.scene),this.treasureAlertMessage=`恭喜你在${this.getSceneName(e.scene)}找到宝藏，获得${e.score}分！`,this.saveUserData();const s=this.checkForNewUnlockedScenes();if(s.length>0){const e=s.map(e=>this.getSceneName(e)).join("、");alert(`${this.treasureAlertMessage}\n🎉 恭喜解锁新场景: ${e}`)}else alert(this.treasureAlertMessage)},checkForNewUnlockedScenes(){const e=[],s=["library","forest","river","temple","chamber"];for(const t of s)if("library"!==t&&this.isSceneUnlocked(t)){const s=!this.currentUser.completedScenes.includes(t);s&&e.push(t)}return e},getSceneName(e){const s={library:"古老的图书馆",forest:"神秘森林",river:"河流探险",temple:"太阳神殿",chamber:"宝藏密室"};return s[e||this.currentScene]||e||this.currentScene},handleHotspotClick(e){if(e.unlocked||"library"===e.target)this.changeScene(e.target);else{const s={library:0,forest:100,river:300,temple:500,chamber:800};alert(`需要达到${s[e.target]}分才能解锁${e.label}！`)}},backToPanorama(){this.showPanorama=!0},switchToNextScene(){const e=["library","forest","river","temple","chamber"],s=e.indexOf(this.currentScene);for(let t=1;t<e.length;t++){const n=(s+t)%e.length;if(this.isSceneUnlocked(e[n]))return void this.changeScene(e[n])}}},beforeUnmount(){this.saveUserData()}},Ne=(0,i.A)(Oe,[["render",G],["__scopeId","data-v-4b26d977"]]),Qe=Ne,Ke={class:"rank-view"};function He(e,s,t,n,a,o){const i=(0,r.g2)("RankList");return(0,r.uX)(),(0,r.CE)("div",Ke,[(0,r.bF)(i,{players:a.players,currentUsername:a.currentUsername,onBack:o.goToGame},null,8,["players","currentUsername","onBack"])])}const qe={class:"rank-container"},je={class:"rank-header"},Je={class:"rank-list"},Ve={class:"rank-item top-rank first-place"},ze={class:"rank-info"},Ye={class:"username"},Ze={class:"score-info"},es={class:"score"},ss={class:"time"},ts={class:"rank-item top-rank second-place"},ns={class:"rank-info"},rs={class:"username"},as={class:"score-info"},os={class:"score"},is={class:"time"},cs={class:"rank-item top-rank third-place"},ls={class:"rank-info"},us={class:"username"},ds={class:"score-info"},hs={class:"score"},ms={class:"time"},ks={class:"rank-number"},gs={class:"rank-info"},ps={class:"username"},vs={class:"score-info"},ys={class:"score"},Ls={class:"time"},fs={key:0,class:"no-records"},Cs={key:0,class:"current-user-rank"};function bs(e,s,t,n,a,o){return(0,r.uX)(),(0,r.CE)("div",qe,[(0,r.Lk)("div",je,[s[1]||(s[1]=(0,r.Lk)("h2",null,"🏆 寻宝排行榜",-1)),(0,r.Lk)("button",{onClick:s[0]||(s[0]=(...e)=>o.backToGame&&o.backToGame(...e)),class:"back-btn"},"返回游戏")]),(0,r.Lk)("div",Je,[(0,r.Lk)("div",Ve,[s[2]||(s[2]=(0,r.Lk)("div",{class:"rank-number"},"🥇",-1)),(0,r.Lk)("div",ze,[(0,r.Lk)("div",Ye,(0,d.v_)(o.topPlayers.first?.username||"-"),1),(0,r.Lk)("div",Ze,[(0,r.Lk)("span",es,(0,d.v_)(o.topPlayers.first?.score||0),1),(0,r.Lk)("span",ss,(0,d.v_)(o.formatTime(o.topPlayers.first?.time||0)),1)])])]),(0,r.Lk)("div",ts,[s[3]||(s[3]=(0,r.Lk)("div",{class:"rank-number"},"🥈",-1)),(0,r.Lk)("div",ns,[(0,r.Lk)("div",rs,(0,d.v_)(o.topPlayers.second?.username||"-"),1),(0,r.Lk)("div",as,[(0,r.Lk)("span",os,(0,d.v_)(o.topPlayers.second?.score||0),1),(0,r.Lk)("span",is,(0,d.v_)(o.formatTime(o.topPlayers.second?.time||0)),1)])])]),(0,r.Lk)("div",cs,[s[4]||(s[4]=(0,r.Lk)("div",{class:"rank-number"},"🥉",-1)),(0,r.Lk)("div",ls,[(0,r.Lk)("div",us,(0,d.v_)(o.topPlayers.third?.username||"-"),1),(0,r.Lk)("div",ds,[(0,r.Lk)("span",hs,(0,d.v_)(o.topPlayers.third?.score||0),1),(0,r.Lk)("span",ms,(0,d.v_)(o.formatTime(o.topPlayers.third?.time||0)),1)])])]),s[5]||(s[5]=(0,r.Lk)("div",{class:"rank-separator"},"其他玩家",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.otherPlayers,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"rank-item"},[(0,r.Lk)("div",ks,(0,d.v_)(s+4),1),(0,r.Lk)("div",gs,[(0,r.Lk)("div",ps,(0,d.v_)(e.username),1),(0,r.Lk)("div",vs,[(0,r.Lk)("span",ys,(0,d.v_)(e.score),1),(0,r.Lk)("span",Ls,(0,d.v_)(o.formatTime(e.time)),1)])])]))),128)),0===o.otherPlayers.length?((0,r.uX)(),(0,r.CE)("div",fs," 暂无其他记录 ")):(0,r.Q3)("",!0)]),o.currentUserRank?((0,r.uX)(),(0,r.CE)("div",Cs,[(0,r.Lk)("p",null,"您的排名: #"+(0,d.v_)(o.currentUserRank.rank),1),(0,r.Lk)("p",null,"得分: "+(0,d.v_)(o.currentUserRank.score),1),(0,r.Lk)("p",null,"用时: "+(0,d.v_)(o.formatTime(o.currentUserRank.time)),1)])):(0,r.Q3)("",!0)])}const Ss={name:"RankList",props:{currentUser:{type:Object,default:null}},data(){return{rankData:[]}},computed:{sortedPlayers(){return[...this.rankData].sort((e,s)=>e.score!==s.score?s.score-e.score:e.time-s.time)},topPlayers(){return{first:this.sortedPlayers[0]||null,second:this.sortedPlayers[1]||null,third:this.sortedPlayers[2]||null}},otherPlayers(){return this.sortedPlayers.slice(3)},currentUserRank(){if(!this.currentUser)return null;const e=this.sortedPlayers.findIndex(e=>e.username===this.currentUser.username&&e.timestamp===this.currentUser.timestamp);if(e>-1){const s=this.sortedPlayers[e];return{rank:e+1,score:s.score,time:s.time}}return null}},mounted(){this.loadRankData()},methods:{loadRankData(){const e=localStorage.getItem("treasureHuntRanks");this.rankData=e?JSON.parse(e):[{username:"寻宝大师",score:1500,time:300,timestamp:Date.now()-864e5},{username:"冒险家小明",score:1200,time:350,timestamp:Date.now()-432e3}]},formatTime(e){const s=Math.floor(e/60),t=e%60;return`${s.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},backToGame(){this.$router.push("/game")}}},Ts=(0,i.A)(Ss,[["render",bs]]),Us=Ts,$s={name:"RankView",components:{RankList:Us},data(){return{players:[],currentUsername:""}},mounted(){this.loadRankData()},methods:{loadRankData(){const e=localStorage.getItem("treasureHuntData");if(e){const s=JSON.parse(e);this.players=s.players||[],this.players.sort((e,s)=>s.score-e.score)}},goToGame(){this.$router.push("/")}}},xs=(0,i.A)($s,[["render",He],["__scopeId","data-v-69d4dfcc"]]),_s=xs,ws={class:"user-view"},Xs={class:"user-info"},Is={key:0,class:"user-details"},Es={key:1};function Ds(e,s,t,n,a,o){return(0,r.uX)(),(0,r.CE)("div",ws,[(0,r.Lk)("div",Xs,[s[2]||(s[2]=(0,r.Lk)("h2",null,"👤 个人信息",-1)),a.currentUser?((0,r.uX)(),(0,r.CE)("div",Is,[(0,r.Lk)("p",null,"用户名: "+(0,d.v_)(a.currentUser.username),1),(0,r.Lk)("p",null,"总分: "+(0,d.v_)(a.currentUser.score),1),(0,r.Lk)("p",null,"找到的宝藏: "+(0,d.v_)(a.currentUser.treasures),1),(0,r.Lk)("p",null,"收集的线索: "+(0,d.v_)(a.collectedClues.length),1)])):((0,r.uX)(),(0,r.CE)("div",Es,[...s[1]||(s[1]=[(0,r.Lk)("p",null,"请先登录游戏",-1)])])),(0,r.Lk)("button",{class:"back-button",onClick:s[0]||(s[0]=(...e)=>o.goToGame&&o.goToGame(...e))},"返回游戏")])])}const Ps={name:"UserView",data(){return{currentUser:null,collectedClues:[]}},mounted(){this.loadUserData()},methods:{loadUserData(){const e=localStorage.getItem("treasureHuntData");if(e){const s=JSON.parse(e),t=localStorage.getItem("currentUsername");if(t&&s.players){const e=s.players.find(e=>e.username===t);e&&(this.currentUser=e)}this.collectedClues=s.collectedClues||[]}},goToGame(){this.$router.push("/")}}},Fs=(0,i.A)(Ps,[["render",Ds],["__scopeId","data-v-1d0eb684"]]),As=Fs,Gs=[{path:"/",name:"Game",component:Qe},{path:"/rank",name:"Rank",component:_s},{path:"/user",name:"User",component:As}],Ms=(0,u.aE)({history:(0,u.LA)("/treasure-hunt-game.GitHub.io/"),routes:Gs}),Rs=Ms,Ws=(0,n.Ef)(l);Ws.use(Rs),Ws.mount("#app")}},s={};function t(n){var r=s[n];if(void 0!==r)return r.exports;var a=s[n]={exports:{}};return e[n](a,a.exports,t),a.exports}t.m=e,(()=>{var e=[];t.O=(s,n,r,a)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){for(var[n,r,a]=e[u],i=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(t.O).every(e=>t.O[e](n[c]))?n.splice(c--,1):(i=!1,a<o&&(o=a));if(i){e.splice(u--,1);var l=r();void 0!==l&&(s=l)}}return s}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]}})(),(()=>{t.d=(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s)})(),(()=>{var e={524:0};t.O.j=s=>0===e[s];var s=(s,n)=>{var r,a,[o,i,c]=n,l=0;if(o.some(s=>0!==e[s])){for(r in i)t.o(i,r)&&(t.m[r]=i[r]);if(c)var u=c(t)}for(s&&s(n);l<o.length;l++)a=o[l],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(u)},n=self["webpackChunktreasure_hunt_game"]=self["webpackChunktreasure_hunt_game"]||[];n.forEach(s.bind(null,0)),n.push=s.bind(null,n.push.bind(n))})();var n=t.O(void 0,[504],()=>t(906));n=t.O(n)})();
//# sourceMappingURL=app.03c5042f.js.map